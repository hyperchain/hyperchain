

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>分区共识 &mdash; hyperchain  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="安全审计" href="Security%20Audit.html" />
    <link rel="prev" title="预言机" href="Oracle.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> hyperchain
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">平台介绍:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">平台介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="Version%20information.html">版本信息</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">快速入门:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="General%20Concepts.html">通用概念</a></li>
<li class="toctree-l1"><a class="reference internal" href="Prepare.html">准备工作</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">快速入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="invoking%20contract.html">合约部署及调用</a></li>
<li class="toctree-l1"><a class="reference internal" href="hyperchain_samples.html">使用示例</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">基础协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="consensus%20mechanism.html">共识机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="Networking%20protocol.html">网络协议</a></li>
<li class="toctree-l1"><a class="reference internal" href="execution%20engine.html">执行引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="Storage%20model.html">存储模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="security%20mechanism.html">加密机制</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">扩展协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Architecture%20development.html">架构拓展</a></li>
<li class="toctree-l1"><a class="reference internal" href="Safe%20Privacy.html">安全隐私</a></li>
<li class="toctree-l1"><a class="reference internal" href="Governonce%20and%20audit.html">治理与审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data%20management.html">数据管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Operation%20manage.html">运维管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ecological%20components.html">区块链生态组件</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">用户手册:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Data%20Index.html">数据索引</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data%20Archiving.html">数据归档</a></li>
<li class="toctree-l1"><a class="reference internal" href="Trusted%20File%20Sharing.html">可信文件共享</a></li>
<li class="toctree-l1"><a class="reference internal" href="Oracle.html">预言机</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">分区共识</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">功能概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">使用说明</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">节点启动配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">节点动态增删分区</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">使用示例</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id7">操作实例</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id8">场景说明</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">节点启动</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">增加分区</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">分区新增节点</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id12">接口参数说明</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id13">注意事项</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Security%20Audit.html">安全审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="Interface%20Authority%20Management.html">接口权限管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chain%20Authority%20Management.html">链级权限管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Simulate%20Contract.html">Simulate合约</a></li>
<li class="toctree-l1"><a class="reference internal" href="Message%20Subscription.html">消息订阅MQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data%20Monitor.html">数据监控</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">应用场景:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="application.html">应用案例</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">更多资源:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Community_Resources.html">社区与资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hyperchain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>分区共识</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Partition Consensus.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>分区共识<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>功能概述<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>多分区架构如下图所示，使用时需遵循以下规则：</p>
<ul class="simple">
<li><p>所有节点都必须在 <strong>global</strong> 这个namespace下；</p></li>
<li><p>任意四个及以上节点可以组成一个新的namespace；</p></li>
<li><p>在多namespace运行的情况下，某一个ns的宕机不影响其他ns运行；</p></li>
<li><p>但是如果global宕机，所有ns将一起停止。</p></li>
</ul>
<p><img alt="image0" src="_images/PartitionConsensus1.jpg" /></p>
</div>
<div class="section" id="id3">
<h2>使用说明<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>多分区的使用可以在节点启动时配置，也可以在启动后通过IPC命令进行动态增删。</p>
<div class="section" id="id4">
<h3>节点启动配置<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>节点在启动前可以配置多个分区，配置后的目录结构如下</p>
<p><img alt="image1" src="_images/PartitionConsensus2.jpg" /></p>
<p>其中，global分区是必须存在的，且必须连接网络中的所有节点。在系统资源充足的情况下，其他分区的个数不做限制。每一个分区下的 <code class="docutils literal notranslate"><span class="pre">ns_dynamic.toml</span></code> 文件需要配置该分区下连接的节点。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">nodes</span><span class="p">]]</span>
<span class="n">hostname</span>    <span class="o">=</span> <span class="s2">&quot;node1&quot;</span>

<span class="p">[[</span><span class="n">nodes</span><span class="p">]]</span>
<span class="n">hostname</span>    <span class="o">=</span> <span class="s2">&quot;node2&quot;</span>

<span class="p">[[</span><span class="n">nodes</span><span class="p">]]</span>
<span class="n">hostname</span>    <span class="o">=</span> <span class="s2">&quot;node3&quot;</span>

<span class="p">[[</span><span class="n">nodes</span><span class="p">]]</span>
<span class="n">hostname</span>    <span class="o">=</span> <span class="s2">&quot;node4&quot;</span>
</pre></div>
</div>
<p>此外，节点的 <code class="docutils literal notranslate"><span class="pre">configuration/dynamic.toml</span></code> 中需要加入其他分区</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span> <span class="o">=</span> <span class="s2">&quot;node1&quot;</span>

<span class="p">[[</span><span class="n">namespace</span><span class="p">]]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;global&quot;</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">true</span>

<span class="p">[[</span><span class="n">namespace</span><span class="p">]]</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ns1&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">true</span>

<span class="p">[[</span><span class="n">namespace</span><span class="p">]]</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ns2&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>start字段表示节点启动时是否启动该分区。如需全部启动，则将start均设置为true。</p>
</div>
<div class="section" id="id5">
<h3>节点动态增删分区<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>节点在启动后，可以通过ipc命令增删分区。</p>
<p>namespace有4个子命令，分别用于 <strong>启动（start）、停止（stop）、删除（destroy）、列举（list）namespace</strong>。</p>
<p>namespace相关的ipc命令时针对节点级别的，启停namespace只影响该节点中的ns列表，而不会影响全局的ns列表。如果要在已有分区中增删节点，需要使用配置交易增删节点功能。</p>
<p><strong>namespace start</strong></p>
<p><strong>命令</strong> ： namespace start &lt;namespace name&gt;</p>
<p>启动一个namespace。启动的namespace需要保证还未在线上运行，且配置文件准备正确。</p>
<p>例子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">namespace</span> <span class="n">start</span> <span class="n">ns1</span>
<span class="go">Error: namespace exist</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">namespace</span> <span class="n">start</span> <span class="n">ns2</span>
<span class="go">successfully start namespace: &quot;ns2&quot;</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p><strong>namespace stop</strong></p>
<p><strong>命令</strong>：namespace stop &lt;namespace name&gt;</p>
<p>停止一个正在运行的namespace。</p>
<p>例子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">namespace</span> <span class="n">stop</span> <span class="n">ns1</span>
<span class="go">Error: namespace &quot;ns1&quot; is not running</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">namespace</span> <span class="n">stop</span> <span class="n">ns2</span>
<span class="go">successfully stop namespace &quot;ns2&quot;</span>
</pre></div>
</div>
<p><strong>namespace destroy</strong></p>
<p><strong>命令</strong>：namespace destroy &lt;namespace name&gt;</p>
<p>删除一个namespace下的所有数据。</p>
<p>例子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">namespace</span> <span class="n">destroy</span> <span class="n">ns1</span>
<span class="go">Error: namespace has not stopped</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">namespace</span> <span class="n">destroy</span> <span class="n">ns2</span>
<span class="go">successufully destroy namespace &quot;ns2&quot;</span>
</pre></div>
</div>
<p><strong>namespace list</strong></p>
<p><strong>命令</strong>：namespace list</p>
<p>列举目前正在运行的namespace。</p>
<p>例子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">namespace</span> <span class="nb">list</span>
<span class="go">global,ns1,ns2</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>使用示例<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p><strong>1. 节点运行过程中，某节点加入一个分区</strong></p>
<p>该节点在configuration目录下建立一个该分区名对应的文件夹，放入配置好的ns_dynamic.toml和ns_static文件，使用ipc命令namespace start &lt;namespace name&gt;即可。</p>
<p><strong>2. 节点运行过程中，某节点停止运行一个分区</strong></p>
<p>该节点使用ipc命令namespace stop &lt;namespace name&gt;即可。</p>
</div>
</div>
<div class="section" id="id7">
<h2>操作实例<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id8">
<h3>场景说明<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>以要建立如图所示的一个分区架构为例，初始有global和ns1分区，运行一段时间后添加ns2分区。</p>
<p><img alt="image2" src="_images/PartitionConsensus3.jpg" /></p>
</div>
<div class="section" id="id9">
<h3>节点启动<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>启动时node1、2、4、5配置global和ns1两个分区，node3、6仅配置global分区启动。</p>
</div>
<div class="section" id="id10">
<h3>增加分区<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>node2、3、5、6在configuration文件夹下建立ns2文件夹，里面写入配置文件，通过ipc命令namespace start ns2新增分区ns2。</p>
</div>
<div class="section" id="id11">
<h3>分区新增节点<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>如ns2分区增加4号节点。首先通过配置交易在ns2分区中申请加入node4。然后node4在configuration文件夹下建立ns2文件夹，里面写入配置文件，通过ipc命令namespace start ns2启动分区ns2。</p>
</div>
</div>
<div class="section" id="id12">
<h2>接口参数说明<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>向节点发送交易的接口参数中有namespace字段，默认为global，若需要向其他分区发送请求，该字段填入分区名即可。例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Request</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">--</span><span class="n">data</span> <span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;namespace&quot;:&quot;ns2&quot;,</span>
<span class="s2">&quot;method&quot;</span><span class="p">:</span><span class="s2">&quot;tx_sendTransaction&quot;</span><span class="p">,</span><span class="s2">&quot;params&quot;</span><span class="p">:</span>
<span class="p">[{</span><span class="s2">&quot;signature&quot;</span><span class="p">:</span><span class="s2">&quot;01047ea464762c333762d3be8a04536b22955d97231062442f81a3cff46cb009bbdbb0f30e61ade5705254d4e4e0c0745fb3ba69006d4b377f82ecec05ed094dbe873046022100b16176bc233000f9039a4209daa82a1c7bc662cbfe7cbef7b8ae44dc81043335022100e8f87fff65631726b3975a54c5c561b3277b6d60b2138cdd8281abc23dafd4f1&quot;</span><span class="p">,</span><span class="s2">&quot;extra&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="s2">&quot;0x856E2B9A5FA82FD1B031D1FF6863864DBAC7995D&quot;</span><span class="p">,</span><span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="s2">&quot;0x794BF01AB3D37DF2D1EA1AA4E6F4A0E988F4DEA5&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;EVM&quot;</span><span class="p">,</span><span class="s2">&quot;nonce&quot;</span><span class="p">:</span><span class="mi">8916188877127249</span><span class="p">,</span><span class="s2">&quot;simulate&quot;</span><span class="p">:</span><span class="n">false</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="mi">53</span><span class="p">,</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span><span class="mi">1566188957839922607</span><span class="p">}],</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="s1">&#39;</span>

<span class="o">//</span> <span class="n">Result</span>
<span class="p">{</span>
    <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;namespace&quot;</span><span class="p">:</span> <span class="s2">&quot;ns2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;0xed2ee1d92b7f99b69ca5b736e424f92d5118494d311b0c1efaa0f0941e1a4cca&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h2>注意事项<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>节点的ipc命令只能控制节点自身的分区启停，并不能完成增删节点操作，增删节点需要通过配置交易完成。</p></li>
<li><p>当使用ipc命令退出global分区后，整个节点将退出。</p></li>
<li><p>分区退出后，dynamic.toml配置中分区的start值将改为false，若节点重启时需要启动该分区，请调整配置文件。</p></li>
<li><p>分区间彼此独立，但共享系统资源，若业务要求多分区架构，需要保证有更高的机器配置，可以考虑将节点各分区的数据挂载在不同磁盘下。</p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Security%20Audit.html" class="btn btn-neutral float-right" title="安全审计" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Oracle.html" class="btn btn-neutral float-left" title="预言机" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Hyperchain Corp..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>