

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>安全审计 &mdash; hyperchain  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="接口权限管理" href="Interface%20Authority%20Management.html" />
    <link rel="prev" title="分区共识" href="Partition%20Consensus.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> hyperchain
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">平台介绍:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">平台介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="Version%20information.html">版本信息</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">快速入门:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="General%20Concepts.html">通用概念</a></li>
<li class="toctree-l1"><a class="reference internal" href="Prepare.html">准备工作</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">快速入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="invoking%20contract.html">合约部署及调用</a></li>
<li class="toctree-l1"><a class="reference internal" href="hyperchain_samples.html">使用示例</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">基础协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="consensus%20mechanism.html">共识机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="Networking%20protocol.html">网络协议</a></li>
<li class="toctree-l1"><a class="reference internal" href="execution%20engine.html">执行引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="Storage%20model.html">存储模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="security%20mechanism.html">加密机制</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">扩展协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Architecture%20development.html">架构拓展</a></li>
<li class="toctree-l1"><a class="reference internal" href="Safe%20Privacy.html">安全隐私</a></li>
<li class="toctree-l1"><a class="reference internal" href="Governonce%20and%20audit.html">治理与审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data%20management.html">数据管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Operation%20manage.html">运维管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ecological%20components.html">区块链生态组件</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">用户手册:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Data%20Index.html">数据索引</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data%20Archiving.html">数据归档</a></li>
<li class="toctree-l1"><a class="reference internal" href="Trusted%20File%20Sharing.html">可信文件共享</a></li>
<li class="toctree-l1"><a class="reference internal" href="Oracle.html">预言机</a></li>
<li class="toctree-l1"><a class="reference internal" href="Partition%20Consensus.html">分区共识</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">安全审计</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">功能概述</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">审计后端</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">审计级别</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">审计事件格式</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">审计日志等级</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">审计日志标签</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">审计事件清单</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id10">安装及初始化</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11">配置说明</a></li>
<li class="toctree-l3"><a class="reference internal" href="#filelog">Filelog说明</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graylog">Graylog安装及使用</a></li>
<li class="toctree-l3"><a class="reference internal" href="#elk">ELK安装及使用</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Interface%20Authority%20Management.html">接口权限管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chain%20Authority%20Management.html">链级权限管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Simulate%20Contract.html">Simulate合约</a></li>
<li class="toctree-l1"><a class="reference internal" href="Message%20Subscription.html">消息订阅MQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data%20Monitor.html">数据监控</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">应用场景:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="application.html">应用案例</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">更多资源:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Community_Resources.html">社区与资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hyperchain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>安全审计</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Security Audit.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>安全审计<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>功能概述<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>系统审计指对一个信息系统的运行状况进行检查与评价，以判断信息系统是否能够保证资产的安全、数据的完整以及有效率利用组织的资源并有效果地实现组织目标。</p>
<p>审计功能对区块链系统进行审计，对整个系统的运行过程进行数据采集记录，审计员可以根据这些审计记录进行分析以完成对区块链系统的审计。在趣链区块链平台中， <strong>审计日志统一以审计事件的形式表示</strong>，审计事件主要为平台中各种的消息通信事件，例如外部的请求调用事件，各个模块之间的消息通信事件、账本数据变更事件、系统异常事件等。</p>
<div class="section" id="id3">
<h3>审计后端<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>审计后端的功能是将平台产生的审计日志进行存储，目前平台支持的审计后端有三种类型：</p>
<ul class="simple">
<li><p><strong>文件</strong>：文件后端直接将审计日志以json的格式写入日志文件;</p></li>
<li><p><strong>filelog</strong>：将审计日志写入filelog存储，支持存储加密;</p></li>
<li><p><strong>webhook</strong>：将审计日志发送到外部。</p></li>
</ul>
<p>目前，webhook方式对两个常用的分析平台做了适配：</p>
<ul class="simple">
<li><p><strong>ELK</strong>：将审计日志直接发送到elk（集群）的URL；</p></li>
<li><p><strong>GrayLog</strong>：将审计日志直接发送到graylog（集群）的URL。</p></li>
</ul>
</div>
<div class="section" id="id4">
<h3>审计级别<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>当前审计功能提供如下四种级别的审计:</p>
<ul class="simple">
<li><p><strong>None</strong> ：不记录审计日志；</p></li>
<li><p><strong>Metadata</strong> ：只提供基础的事件信息，包括事件类型，时间戳，事件具体内容等；如果是外部请求事件，则还会包括ip，证书，请求url，响应码；</p></li>
<li><p><strong>ResponseBody</strong> ：对于api外部请求（如客户端jsonRPC调用）增加请求响应，对于内部事件为事件结果（对于能同步获取结果的事件），比如数据同步的时间消耗；</p></li>
<li><p><strong>StorageObjec</strong> ：最全记录方式，提供状态修改的变更。</p></li>
</ul>
<p>用户可根据审计需求开启适当的审计级别。 <strong>注意：审计级别越高则输出的内容越多，对平台的性能影响也越大。</strong></p>
</div>
<div class="section" id="id5">
<h3>审计事件格式<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>审计事件包含字段如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{
    &quot;source&quot;:&quot;node1&quot;,      # 审计日志来源节点名称
    &quot;namespace&quot;:&quot;global&quot;,  # 产生审计日志的namespace
    &quot;audit_type_id&quot;:400,   # 审计记录的类型ID，参照审计类型表
    &quot;tags&quot;:[
        &quot;xxx&quot;              # 审计记录的tag，可方便检索
    ],
    &quot;risk_level&quot;:0,        # 审计日志等级
    &quot;user&quot;:{               # 审计日志发起者，外部请求会填充此字段
        &quot;ip&quot;:&quot;127.0.0.1:50444&quot;,&quot;cert&quot;:&quot;xxx&quot;
    },
    &quot;event_body&quot;:{         # 审计日志主题，包含审计级别request的主要内容
        &quot;value&quot;:{          # value字段为对象类型，body为额外的key,value类型
            &quot;replica_id&quot;:3,&quot;view&quot;:2
        },
        &quot;body&quot;:{
        &quot;nodeHash&quot;:&quot;c82a71a88c58540c62fc119e78306e7fdbe114d9b840c47ab564767cb1c706e2&quot;
        }
    }，
    &quot;event_response&quot;:{       # 对应审计级别responsebody的主要内容
        &quot;body&quot;:{
            &quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;namespace&quot;:&quot;global&quot;,&quot;id&quot;:1,&quot;code&quot;:-32003,&quot;message&quot;:&quot;Invalid signature: tx hash 0x30693b679e8e5cb6fb61c3c4fed96616fb6aedcde37928d23de983dc2aec75e4&quot;
        }
    }
}
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>审计日志等级<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>目前将审计日志的级别划分为三种，级别包括 <strong>危险(RISK)、警告(WARN)、普通(NORAMAL)</strong>，分别对应 <cite>risk_level</cite> 字段的数字为 <strong>0、1、2</strong>。</p>
<ul class="simple">
<li><p>RISK：指系统出现的难以恢复异常或严重错误，会影响系统的正常运行，如写块错误；</p></li>
<li><p>WARN：指系统出现的可恢复异常，不会影响系统的正常运行，如交易执行失败，一些异常行为如viewchange等；</p></li>
<li><p>NORAMAL：一般系统事件，如正常请求。</p></li>
</ul>
</div>
<div class="section" id="id7">
<h3>审计日志标签<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>日志的标签用于将审计事件归类，以便于在搜索审计事件的时候能快速定位以及区分审计事件，为 <cite>Tags</cite> 字段。</p>
<p>当前日志标签的包含有如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ReceivedMessage = &quot;ReceivedMessage&quot; // 代表（从其他节点或模块）接收到的消息
SentMessage     = &quot;SentMessage&quot; // 代表发出的消息
</pre></div>
</div>
<p>每个审计事件可以有多个标签。</p>
</div>
<div class="section" id="id8">
<h3>审计事件清单<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>审计事件的详细清单请点击<a class="reference external" href="https://upload.filoop.com/%E5%AE%A1%E8%AE%A1%E4%BA%8B%E4%BB%B620201111.xlsx">此处</a></p>
</div>
</div>
<div class="section" id="id10">
<h2>安装及初始化<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id11">
<h3>配置说明<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>安全审计功能是可选的（默认不开启），即可以通过节点开关配置来决定节点是否启用审计功能，相关配置位于 <code class="docutils literal notranslate"><span class="pre">configuration/global/system.toml</span></code> 中。</p>
<p>平台默认不开启安全审计功能， <strong>如果您想启用该功能，请将下述配置复制到system.toml中，并做好相应配置</strong>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">audit</span><span class="p">]</span>
    <span class="n">backend</span>   <span class="o">=</span> <span class="s2">&quot;graylog&quot;</span>      <span class="c1">#审计后端类型，可选项包括&quot;file&quot;, &quot;filelog&quot; ,&quot;graylog&quot;和&quot;elk&quot;，实际不建议选用前两者</span>
    <span class="n">level</span>     <span class="o">=</span> <span class="s2">&quot;none&quot;</span>         <span class="c1">#审计的级别，级别越高输出的内容越详细，从低到高的级别依次是：none, metadata, responsebody, storageobject，其中如果将审计级别配置为none，则代表不开启审计，平台的审计服务将不会启动</span>
    <span class="p">[</span><span class="n">audit</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">pool</span><span class="p">]</span>
            <span class="n">urls</span>  <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;172.16.5.5:12202&quot;</span><span class="p">]</span>   <span class="c1">#外部URL 可配置一个或者多个，根据实际使用的审计后端配置，格式为&quot;IP+端口号&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="filelog">
<h3>Filelog说明<a class="headerlink" href="#filelog" title="Permalink to this headline">¶</a></h3>
<p>审计会使用到filelog的场景有两种：</p>
<ul class="simple">
<li><p><strong>将filelog作为审计后端</strong>：将filelog作为审计后端时，审计日志会存储在节点的指定filelog数据库中，支持filelog加密存储。 <strong>实际场景中，不推荐使用file或者filelog作为审计后端。</strong></p></li>
<li><p><strong>使用GrayLog或者ELK作为审计后端</strong>：当使用Graylog或者ELK作为审计后端时，平台会使用filelog作为审计消息发送失败时的临时存储。当配置的所有url的网络连接暂时不可用时，平台会将产生的审计日志临时写入filelog，当后续与审计后端的网络连接恢复成功，filelog中的审计日志会自动恢复到配置的审计后端。</p></li>
</ul>
</div>
<div class="section" id="graylog">
<h3>Graylog安装及使用<a class="headerlink" href="#graylog" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>使用Graylog作为审计后端需将配置项 <cite>backend</cite> 设置为 <cite>graylog</cite> 。 <strong>注意</strong>：在平台向外部URL发送失败时会暂时使用filelog存储，因此使用GrayLog作为后端仍然需要配置filelog。</p></li>
<li><p><strong>使用Glaylog作为后端需要事先搭建好graylog平台，详情请参考：</strong><a class="reference external" href="https://upload.filoop.com/Graylog%E5%AE%A1%E8%AE%A1%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C.docx">Graylog审计使用手册</a>。</p></li>
<li><p>搭建好之后将graylog的URL配置在[audit.conn.pool]配置之下的`urls` 配置项之中即可。</p></li>
</ol>
</div>
<div class="section" id="elk">
<h3>ELK安装及使用<a class="headerlink" href="#elk" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>使用ELK作为审计后端需将配置项 <cite>backend</cite> 设置为 <cite>elk</cite>。 <strong>注意</strong>：在平台向外部URL发送失败时会暂时使用filelog存储，因此使用ELK作为后端仍然需要配置filelog。</p></li>
<li><p><strong>使用ELK作为后端需要事先搭建好ELK平台，详情请参考：</strong><a class="reference external" href="https://upload.filoop.com/ELK%E5%AE%A1%E8%AE%A1%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C.docx">ELK审计使用手册</a>。</p></li>
<li><p>搭建好之后，将filebeat的URL配置在 <code class="docutils literal notranslate"><span class="pre">[audit.conn.pool]</span></code> 配置之下的 <cite>urls</cite> 配置项之中，然后在filebeat的配置文件中配置上Elasticsearch(集群)的URL即可。</p></li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Interface%20Authority%20Management.html" class="btn btn-neutral float-right" title="接口权限管理" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Partition%20Consensus.html" class="btn btn-neutral float-left" title="分区共识" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Hyperchain Corp..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>