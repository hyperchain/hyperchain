

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>数字证书 &mdash; hyperchain  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="hyperchain  documentation" href="index.html"/>
        <link rel="next" title="分区共识" href="namespace_cn.html"/>
        <link rel="prev" title="交易执行流程" href="txflow_cn.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> hyperchain
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">系统架构:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="txflow_cn.html">交易执行流程</a></li>
</ul>
<p class="caption"><span class="caption-text">隐私与安全:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">数字证书</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#">1.概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="#">2.证书简述</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ca">3.CA相关配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="#">4.证书获取以及校验流程</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ecertrcert">4.1 ECert和RCert</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#">4.1.1 获取</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">4.1.2 校验</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tcert">4.2 TCert</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#">4.2.1 获取</a></li>
<li class="toctree-l4"><a class="reference internal" href="#">4.2.2 校验</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="namespace_cn.html">分区共识</a></li>
<li class="toctree-l1"><a class="reference internal" href="crypto_cn.html">密码学算法</a></li>
</ul>
<p class="caption"><span class="caption-text">用户手册:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="JSON-RPC_manual_cn.html">JSON-RPC API</a></li>
<li class="toctree-l1"><a class="reference internal" href="node_op_cn.html">节点操作</a></li>
</ul>
<p class="caption"><span class="caption-text">开发计划:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="roadmap_cn.html">Hyperchain 开发路线图</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hyperchain</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>数字证书</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ca_manager_cn.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="">
<span id="id1"></span><h1>数字证书<a class="headerlink" href="#" title="Permalink to this headline">¶</a></h1>
<div class="section" id="">
<span id="id2"></span><h2>1.概述<a class="headerlink" href="#" title="Permalink to this headline">¶</a></h2>
<p>Hyperchain是一个联盟链级别的区块链服务平台，拥有精确的权限控制粒度，需要通过多级的CA证书来进行权限控制。权限控制主要分为两个方面：</p>
<ul class="simple">
<li>节点权限控制</li>
<li>交易权限控制</li>
</ul>
<p>首先我们需要知道的是，权限控制是Namespace级别的，即每个Namespace就会拥有一个相应CaManager来进行CA证书的管理以及Namespace级别的权限控制。以下是我们的PKI体系(证书体系)图：</p>
<p><img alt="" src="_images/ca.png" /></p>
<ul class="simple">
<li>root.ca(根证书颁发机构):它代表PKI体系中的信任锚。数字证书的验证遵循信任链。根CA是PKI层次结构中最上层的CA，用于签发证书认证机构以及角色证书准入认证机构。</li>
<li>eca.ca(准入证书颁发机构):用于给节点颁发节点准入证书(ecert)和sdk证书(sdkcert)。</li>
<li>rca.ca(角色证书颁发机构):用于给节点颁发角色证书(rcert)。</li>
<li>ecert.cert(准入证书):准入证书是长期证书，是颁发给节点的，用于节点的准入，若无准入证书，则该节点无法加入此Namespace，同时准入证书也作为交易证书的颁发机构用于颁发交易证书。</li>
<li>rcert.cert(角色证书):角色证书是长期证书，是颁发给节点的，用于节点的角色的认证，若无角色证书，则此节点为NVP，无法参与共识，反之则为VP节点。</li>
<li>sdkcert.cert(sdk证书):SDK证书时颁发给SDK的，用于进行SDK的身份认证，同时SDK证书时获取交易证书的（Tcert）的判别依据。</li>
<li>tcert.cert(交易证书):SDK发送交易时需携带交易证书，若无交易证书或证书验证失败，则抛弃交易。</li>
</ul>
</div>
<div class="section" id="">
<span id="id3"></span><h2>2.证书简述<a class="headerlink" href="#" title="Permalink to this headline">¶</a></h2>
<p>Hyperchian区块链平台证书均符合ITU-T X.509国际标准，它仅包含了公钥信息而没有私钥信息，是可以公开进行发布的，所以X.509证书对象一般都不需要加密。X.509证书的格式通常如下:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>---BEGIN CERTIFICATE---
……PEM编码的X.509证书内容(省略)……
---END CERTIFICATE---
</pre></div>
</div>
<p>PEM编码全称是Privacy Enhanced Mail，是一种保密邮件的编码标准。通常来说，对信息的编码过程基本如下：</p>
<ul class="simple">
<li>信息转换为ASCII码或其他编码方式，比如采用DER编码。</li>
<li>使用对称加密算法加密经过编码的信息。</li>
<li>使用BASE64对加密码后的信息进行编码。</li>
<li>使用一些头定义对信息进行封装，主要包含了进行正确解码需要的信息。</li>
</ul>
<p>除此以外Hyperchain区块链平台证书内具体包含以下信息：</p>
<p>1、X.509版本号：指出该证书使用了哪种版本的X.509标准，版本号会影响证书中的一些特定信息。目前的版本是3。</p>
<p>2、证书持有人的公钥：包括证书持有人的公钥、算法(指明密钥属于哪种密码系统)的标识符和其他相关的密钥参数。</p>
<p>3、证书的序列号：由CA给予每一个证书分配的唯一的数字型编号，当证书被取消时，实际上是将此证书序列号放入由CA签发的CRL（Certificate Revocation List证书作废表，或证书黑名单表）中。这也是序列号唯一的原因。</p>
<p>4、主题信息：证书持有人唯一的标识符(或称DN-distinguished name)这个名字在 Internet上应该是唯一的。DN由许多部分组成，看起来象这样：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CN</span><span class="o">=</span><span class="n">Bob</span> <span class="n">Allen</span><span class="p">,</span> <span class="n">OU</span><span class="o">=</span><span class="n">Total</span> <span class="n">Network</span> <span class="n">Security</span> <span class="n">Division</span>
<span class="n">O</span><span class="o">=</span><span class="n">Network</span> <span class="n">Associates</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span>
<span class="n">C</span><span class="o">=</span><span class="n">US</span>
</pre></div>
</div>
<p>这些信息指出该科目的通用名、组织单位、组织和国家或者证书持有人的姓名、服务处所等信息。</p>
<p>5、证书的有效期：证书起始日期和时间以及终止日期和时间；指明证书在这两个时间内有效。</p>
<p>6、认证机构：证书发布者，是签发该证书的实体唯一的CA的X.509名字。使用该证书意味着信任签发证书的实体。(注意：在某些情况下，比如根或顶级CA证书，发布者自己签发证书)</p>
<p>7、发布者的数字签名：这是使用发布者私钥生成的签名，以确保这个证书在发放之后没有被撰改过。</p>
<p>8、签名算法标识符：用来指定CA签署证书时所使用的签名算法。算法标识符用来指定CA签发证书时所使用的公开密钥算法和HASH算法。</p>
</div>
<div class="section" id="ca">
<span id="ca"></span><h2>3.CA相关配置<a class="headerlink" href="#ca" title="Permalink to this headline">¶</a></h2>
<p>CA所需配置在namespace.toml配置文件内，具体参数如下：</p>
<div class="highlight-"><div class="highlight"><pre><span></span>[encryption]
[encryption.ecert]
 eca    = &quot;config/certs/eca.cert&quot;
 ecert  = &quot;config/certs/ecert.cert&quot;
 priv   = &quot;config/certs/ecert.priv&quot;

[encryption.rcert]
 #if you do not have rcert, leave this item blank
 rca    = &quot;config/certs/rca.cert&quot;
 rcert  = &quot;config/certs/rcert.cert&quot;
 priv   = &quot;config/certs/rcert.priv&quot;

[encryption.tcert]
 #Tcert whitelist configuration.
 whiteList = false
 listDir  = &quot;config/certs/tcerts&quot;

[encryption.check]
 enable     = true  #enable ERCert
 enableT    = false  #enable TCert
</pre></div>
</div>
<p>首先前六个参数，分别是配置改Namespace的相关证书路径，分别是eca,ecert和ecert对应的私钥，rcar,rcert和rcert对应的私钥。</p>
<p>其次是TCert相关配置，平台支持TCert白名单策略，即在<code class="docutils literal"><span class="pre">whiteList=true</span></code> 时，即开启TCert白名单策略，在<code class="docutils literal"><span class="pre">listDir</span></code>参数配置下的TCert证书则是立即可用交易证书。反之，当<code class="docutils literal"><span class="pre">whiteList</span></code>为false时，则不开启白名单策略，只有在该交易证书合法性验证通过，且确定该交易证书确定为本节点且在Namespace下颁布的交易证书时才可完全验证通过。</p>
<p>最后的两个参数则为配置开关参数，<code class="docutils literal"><span class="pre">enable</span></code>为开启准入证书以及角色证书的校验开关，反之则不进行验证，<code class="docutils literal"><span class="pre">enableT</span></code>则为开启交易证书验证的开关配置，只有当该参数置为true时才进行交易证书的验证。动态的开关配置也使区块链配台更加灵活。</p>
</div>
<div class="section" id="">
<span id="id4"></span><h2>4.证书获取以及校验流程<a class="headerlink" href="#" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ecertrcert">
<span id="ecertrcert"></span><h3>4.1 ECert和RCert<a class="headerlink" href="#ecertrcert" title="Permalink to this headline">¶</a></h3>
<div class="section" id="">
<span id="id5"></span><h4>4.1.1 获取<a class="headerlink" href="#" title="Permalink to this headline">¶</a></h4>
<p>​   准入证书以及角色证书主要是通过线下颁布进行控制，有Certgen证书签发工具进行证书的生成。</p>
</div>
<div class="section" id="">
<span id="id6"></span><h4>4.1.2 校验<a class="headerlink" href="#" title="Permalink to this headline">¶</a></h4>
<p>​   若ECert以及RCert校验开关开启，则具体验证流程如下图所示：</p>
<p><img alt="" src="_images/ercert.png" /></p>
<p>​   ECert以及RCert在节点初次握手连接时进行了证书的互换以及验证，由此来确定了节点是否允许入链以及相关连接节点的角色信息。</p>
</div>
</div>
<div class="section" id="tcert">
<span id="tcert"></span><h3>4.2 TCert<a class="headerlink" href="#tcert" title="Permalink to this headline">¶</a></h3>
<p>​   TCert的获取以及验证的流程图如下图所示：</p>
<p><img alt="" src="_images/tcert.png" /></p>
<div class="section" id="">
<span id="id7"></span><h4>4.2.1 获取<a class="headerlink" href="#" title="Permalink to this headline">¶</a></h4>
<p>​   首先，SDK或者外部应用需要向连接节点发起GetTcert的消息，该消息需要携带SDKCert对该SDK或外部应用进行身份认证，在认证通过后进行TCert证书的生成以及颁布。</p>
</div>
<div class="section" id="">
<span id="id8"></span><h4>4.2.2 校验<a class="headerlink" href="#" title="Permalink to this headline">¶</a></h4>
<p>​   若SDK或者外部应用获取TCert成功后，则接下来的交易需要携带相关交易证书给相关节点进行验证，只有交易证书验证通过后才会进行接下来的交易执行。</p>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="namespace_cn.html" class="btn btn-neutral float-right" title="分区共识" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="txflow_cn.html" class="btn btn-neutral" title="交易执行流程" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Hyperchain Corp..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>